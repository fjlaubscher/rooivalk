![github](https://github.com/user-attachments/assets/cfcc082b-5809-4d82-a537-5d1c44c36d1d)
> Artwork by [Pieter Jordaan](https://www.thisisender.com/)

# Rooivalk
Rooivalk is a Discord bot that leverages OpenAI's API to generate responses when mentioned in a Discord server.<br/>
It is written in TypeScript and designed for easy customization and extension.

## Features
- Integrates with OpenAI for AI-generated replies and images.
- Responds to messages where the bot is mentioned and when replying to a message from the bot.
- Generate images with `/image`
- Generate informative responses with `/learn`
- Retry responses by reacting to a bot message with a specific emoji.
- Custom error messages for failed completions
- Fully configurable (with runtime "hot-reloading") system instructions and fallback messages via `config/*.md` files
- Conversation history is passed as context rather than part of the prompt

### Rooivalk in action

https://github.com/user-attachments/assets/f2ba3afe-4aca-4ac9-bb5b-852aa8277518

## Setup

### Prerequisites
- [Node.js](https://nodejs.org/) (v22 or newer recommended)
- [pnpm](https://pnpm.io/) (v10.x recommended)
- A Discord bot token ([guide](https://discord.com/developers/applications))
- An OpenAI API key ([guide](https://platform.openai.com/account/api-keys))
### Installation

1. Clone the repository:
   ```sh
   git clone https://github.com/fjlaubscher/rooivalk.git
   cd rooivalk
   ```
2. Install dependencies:
   ```sh
   pnpm install
   ```
3. Create a `.env` file in the root directory with the following contents:
   ```env
   DISCORD_STARTUP_CHANNEL_ID=channelidforstartup
   DISCORD_MOTD_CHANNEL_ID=channelidformotd
   DISCORD_TOKEN=discord_app_token
   DISCORD_GUILD_ID=discord_server_id
   DISCORD_APP_ID=discord_app_id
   OPENAI_API_KEY=openai_key
   OPENAI_MODEL=gpt-4.1-nano
   OPENAI_IMAGE_MODEL=gpt-image-1
   ROOIVALK_MOTD_CRON="0 8 * * *"
   ```
4. Build the project:
   ```sh
   pnpm build
   ```
5. Start the bot:
   ```sh
   pnpm start
   ```

### Detailed Project Structure

For a detailed breakdown of the project structure, please refer to [AGENTS.md](./AGENTS.md).

### Customization
- Edit `src/services/openai/index.ts` to change how prompts are sent to OpenAI.
- Edit `src/services/rooivalk/index.ts` to customize the bot's core logic and behavior.
- Update constants in the respective `constants.ts` files for configuration.
- Test utilities are available in `src/test-utils/` for mocking Discord messages in tests.

### Continuous Integration

This project uses GitHub Actions to automatically run tests and deploy the bot. The workflows are located in `.github/workflows/`:
- `test.yml`: Runs tests on every push and pull request to the `main` branch.
- `deploy.yml`: Handles deployment tasks.

No additional setup is requiredâ€”tests and deployments will run automatically if you push changes or open a pull request.

---

## Notes

- The codebase is written in modern TypeScript, using strict mode and modular architecture.
- All tests are written using [Vitest](https://vitest.dev/), and test utilities are provided for mocking Discord interactions.

## License
MIT

![rooivalk](https://github.com/user-attachments/assets/e579da64-fe84-4483-9686-32c65dd23acb)
> This image was generated by @rooivalk.
